<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script>window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.min.js');</script>
    <!-- <script>
        window.nodeRequire = require;
        delete window.require;
        delete window.exports;
        delete window.module;
    </script>
    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script> -->
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css" crossorigin=" anonymous">
    <script
        src="node_modules/popper.js/dist/umd/popper.min.js">require(node_modules / popper.js / dist / umd / popper.min.js)</script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="./TodayController.js"></script>
    <link rel="stylesheet" href="index.css">
    <style type="text/css">
        a:link {
            text-decoration: none;
        }

        a:active {
            text-decoration: none
        }

        a:hover {
            text-decoration: none;
        }

        a:visited {
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div class="display-flex">
        <div class="div-sidebar">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical"
                style="width: 280px;">
                <a class="item-sidebar active" id="v-pills-today-tab" data-toggle="pill" href="#v-pills-today"
                    role="tab" aria-controls="v-pills-today" aria-selected="true">
                    Today
                </a>
                <a class="item-sidebar" id="v-pills-scheduled-tab" data-toggle="pill" href="#v-pills-scheduled"
                    role="tab" aria-controls="v-pills-scheduled" aria-selected="false">
                    Scheduled
                </a>
                <a class="item-sidebar" id="v-pills-completed-tab" data-toggle="pill" href="#v-pills-completed"
                    role="tab" aria-controls="v-pills-completed" aria-selected="false">
                    Completed
                </a>
                <a class="item-sidebar" id="v-pills-allplans-tab" data-toggle="pill" href="#v-pills-allplans" role="tab"
                    aria-controls="v-pills-allplans" aria-selected="false">
                    All Plans
                </a>
                <a class="item-sidebar" id="v-pills-about-tab" data-toggle="pill" href="#v-pills-about" role="tab"
                    aria-controls="v-pills-about" aria-selected="false">
                    About
                </a>
            </div>
        </div>
        <div class="div-content noselect">
            <div class="tab-content" id="v-pills-tabContent" style="flex-grow: 1">
                <div class="tab-pane fade show active" id="v-pills-today" role="tabpanel"
                    aria-labelledby="v-pills-today-tab" style="display: flex; flex-direction: row;">
                    <div class="page">
                        <div id="content-head">
                            <div class="head-title">Today</div>
                            <div class="head-date">2020年8月16日 星期日</div>
                        </div>

                        <div id="table-filter" style="margin-right: 16px; height: 48px;">
                            <div class="dropdown" id="myDropdown"
                                style="float:right; margin-top: 16px; margin-bottom: 8px;">
                                <button class="btn btn-secondary btn-sm dropdown-toggle" type="button"
                                    id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false" onclick="getTypes()">
                                    全部
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" id="today-filter"
                                    aria-labelledby="dropdownMenuButton">
                                    <a class="dropdown-item" href="javascript:onClickDropdown('male')">Male</a>
                                    <a class="dropdown-item" href="javascript:onClickDropdown('female')">Female</a>
                                </div>
                            </div>
                        </div>

                        <div class="table-area noselect" id="table-data">
                            <div class="div-list-item" onclick="chooseItem('yes')">
                                <img src="./res/radio-false.svg" style="align-items: center;"
                                    onclick="finishTodayItem('choose'); event.cancelBubble = true">
                                <p style="margin-left: 16px; height: 45px; line-height: 45px;">
                                    测试项目
                                    <span class="badge"
                                        style="background-color: rgb(102, 188, 214); color: rgb(255, 255, 255)">英语</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="div-details noselect" id="today-details">
                        <p class="detail-name">
                            微积分第一讲极限与极限定义
                            <span class="badge" style="background-color: rgb(102, 188, 214); color: rgb(255, 255, 255)">英语</span>
                            <span class="badge" style="background-color: rgb(139, 223, 91); color: rgb(255, 255, 255)">首次学习</span>
                        </p>
                        <div style="height: 1px; background-color: rgb(237, 237, 237);"></div>
                        <div class="detail-content">
                            <div class="detail-item">
                                <p style="margin-left: 8px; height: 45px; line-height: 45px;">计划完成时间：今天</p>
                            </div>
                        </div>
                        <div style="height: 1px; background-color: rgb(237, 237, 237);"></div>
                        <div class="detail-foot"><img src="./res/close.svg" style="margin: 12px;" onclick="hideTodayItemDetails()">
                        </div>
                    </div>

                </div>
                <div class="tab-pane fade" id="v-pills-scheduled" role="tabpanel"
                    aria-labelledby="v-pills-scheduled-tab">

                </div>
                <div class="tab-pane fade" id="v-pills-completed" role="tabpanel"
                    aria-labelledby="v-pills-completed-tab">

                </div>
                <div class="tab-pane fade" id="v-pills-allplans" role="tabpanel" aria-labelledby="v-pills-allplans-tab">

                </div>
                <div class="tab-pane fade" id="v-pills-about" role="tabpanel" aria-labelledby="v-pills-about-tab">

                </div>
            </div>
        </div>
        
    </div>
</body>

<script src="index.js"></script>
<script>
    // $(function () {
    //     $('#myTab li:last-child a').tab('show')
    //     console.assert(a)
    // })

    // $('#v-pills-today-tab a').on('click', function (e) {
    //     console.assert("qqqqqqqq")
    //     e.preventDefault()
    //     // $(this).tab('show')
    // })
    const DBManager = require('./DatabaseManager')
    const db = new DBManager('MemoryDB')

    // addTypes("Math")
    function addTypes(name) {
        db.transaction('rw', db.types, function* () {

            // Make sure we have something in DB:
            if ((yield db.types.where('name').equals(name).count()) === 0) {
                let id = yield db.types.add({ name: name });
                alert(`Added type with id ${id}`);
            }

            // Query:
            let myTypes = yield db.types.where("name").equals(name).toArray();

            // Show result:
            alert("My types: " + JSON.stringify(myTypes));

        }).catch(e => {
            console.error(e.stack);
        });
    }
    db.addTypes('数学')
    db.addTypes('英语')
    db.queryType(1, function (myType) {
        console.log(myType)
    })
    db.addTask('微积分第一章数列部分', '数学', 0, function(myTask) {
        alert("My types: " + JSON.stringify(myTask));
    })

    getTypes()

    function chooseItem(str) {
        console.log(str)
        $('#today-details').css("display", "")
    }

    function finishToday(str) {
        console.log(str)
    }

    function hideDetails() {
        $('#today-details').css("display", "none")
    }

    function onClickDropdown(str) {
        console.log(str)
        $('#dropdownMenuButton').html(str)
    }

    function getTypes() {
        db.getAllTypes(function (myTypes) {
            console.log('callback+' + myTypes)
            filterHtml = `<a class="dropdown-item" href="javascript:onClickDropdown('全部')">全部</a>`
            for (i = 0; i < myTypes.length; i++) {
                filterHtml += `<a class="dropdown-item" href="javascript:onClickDropdown('${myTypes[i].name}')">${myTypes[i].name}</a>`
            }
            $('#today-filter').html(filterHtml)
        })
    }

    function getTypeNameById(id) {
        db.queryType(id, function (id) {

        })
    }

    $('#v-pills-today-tab').click({ str: 'today' }, testFun);
    $('#v-pills-scheduled-tab').click({ str: 'scheduled' }, testFun);
    $('#v-pills-completed-tab').click({ str: 'completed' }, testFun);
    $('#v-pills-allplans-tab').click({ str: 'allplans' }, testFun);
    $('#v-pills-about-tab').click({ str: 'about' }, testFun);
</script>

</html>